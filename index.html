<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Komik Reader</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: #111;
  color: #fff;
}

header {
  background: #1f1f1f;
  padding: 15px;
  text-align: center;
  font-size: 22px;
  font-weight: bold;
}

/* === SEARCH BAR === */
.search-box {
  display: flex;
  padding: 10px 15px;
  background: #181818;
}

.search-box input {
  flex: 1;
  padding: 12px 14px;
  border-radius: 25px;
  border: none;
  outline: none;
  font-size: 14px;
  background: #2a2a2a;
  color: #fff;
}

.search-box button {
  margin-left: 10px;
  border-radius: 50%;
  width: 42px;
  height: 42px;
  border: none;
  background: #fff;
  font-weight: bold;
  cursor: pointer;
}

/* === NAV TAB === */
.nav {
  display: flex;
  background: #181818;
}

.nav button {
  flex: 1;
  padding: 12px;
  border: none;
  background: none;
  color: #aaa;
  font-weight: bold;
  cursor: pointer;
}

.nav button.active {
  color: #fff;
  background: #222;
  border-bottom: 2px solid #fff;
}

/* === LIST === */
.container {
  padding: 15px;
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
  gap: 15px;
}

.card {
  background: #1c1c1c;
  border-radius: 8px;
  overflow: hidden;
  cursor: pointer;
}

.card img {
  width: 100%;
  height: 220px;
  object-fit: cover;
}

.card-body {
  padding: 10px;
}

.title {
  font-size: 14px;
  font-weight: bold;
}

.info {
  font-size: 12px;
  color: #ccc;
}

/* === DETAIL & READER === */
.detail, .reader {
  display: none;
  padding: 15px;
}

.chapter {
  background: #1c1c1c;
  padding: 10px;
  margin-bottom: 8px;
  border-radius: 5px;
  cursor: pointer;
}

.reader img {
  width: 100%;
  margin-bottom: 10px;
}

.nav-btns {
  display: flex;
  justify-content: space-between;
  margin-bottom: 15px;
}

button {
  padding: 8px 14px;
  border-radius: 5px;
  cursor: pointer;
  font-weight: bold;
}

button:disabled {
  opacity: 0.5;
}

.back-btn {
  background: #444;
  color: #fff;
  margin-bottom: 10px;
}
</style>
</head>

<body>

<header>üìö Komik Reader</header>

<!-- SEARCH -->
<div class="search-box">
  <input id="searchInput" placeholder="Cari judul komik...">
  <button onclick="searchManga()">üîç</button>
</div>

<!-- NAV -->
<div class="nav">
  <button id="tabAll" class="active">üìö Semua</button>
  <button id="tabLatest">üÜï Terbaru</button>
</div>

<!-- LIST -->
<div id="listView">
  <div class="container" id="mangaList"></div>
</div>

<!-- DETAIL -->
<div class="detail" id="detailView">
  <button class="back-btn" onclick="backToList()">‚¨Ö Kembali</button>
  <h2 id="detailTitle"></h2>
  <img id="detailThumb" style="width:150px;border-radius:8px">
  <p id="detailSynopsis"></p>
  <h3>üìñ Chapter</h3>
  <div id="chapterList"></div>
</div>

<!-- READER -->
<div class="reader" id="readerView">
  <button class="back-btn" onclick="backToDetail()">‚¨Ö Kembali</button>
  <h2 id="chapterTitle"></h2>
  <div class="nav-btns">
    <button id="prevChapter">‚¨Ö Sebelumnya</button>
    <button id="nextChapter">Lanjut ‚û°</button>
  </div>
  <div id="imageContainer"></div>
</div>

<script>
const API = "https://unofficial-komikcast-api.vercel.app/komikcast";
const mangaList = document.getElementById("mangaList");

const listView = document.getElementById("listView");
const detailView = document.getElementById("detailView");
const readerView = document.getElementById("readerView");

const tabAll = document.getElementById("tabAll");
const tabLatest = document.getElementById("tabLatest");

let mode = "all";

/* ===== ALL ===== */
async function loadAllManga() {
  mode = "all";
  setActiveTab(tabAll);
  const res = await fetch(API);
  const json = await res.json();
  renderList(json.data);
}

/* ===== LATEST ===== */
async function loadLatestManga() {
  mode = "latest";
  setActiveTab(tabLatest);
  const res = await fetch(`${API}/latest`);
  const json = await res.json();
  renderList(json.data);
}

/* ===== SEARCH ===== */
async function searchManga() {
  const q = document.getElementById("searchInput").value.trim();
  if (!q) return;

  mode = "search";
  tabAll.classList.remove("active");
  tabLatest.classList.remove("active");

  const res = await fetch(`${API}/search?q=${encodeURIComponent(q)}`);
  const json = await res.json();
  renderList(json.data);
}

/* ===== RENDER ===== */
function renderList(data) {
  mangaList.innerHTML = "";
  if (data.length === 0) {
    mangaList.innerHTML = "<p>‚ùå Komik tidak ditemukan</p>";
    return;
  }

  data.forEach(m => {
    const div = document.createElement("div");
    div.className = "card";
    div.innerHTML = `
      <img src="${m.thumbnail}">
      <div class="card-body">
        <div class="title">${m.title}</div>
        <div class="info">${m.latest_chapter?.title || ""}</div>
      </div>
    `;
    div.onclick = () => loadDetail(m.slug);
    mangaList.appendChild(div);
  });
}

/* ===== DETAIL ===== */
async function loadDetail(slug) {
  listView.style.display = "none";
  detailView.style.display = "block";

  const res = await fetch(`${API}/detail/${slug}`);
  const json = await res.json();
  const d = json.data;

  document.getElementById("detailTitle").textContent = d.title;
  document.getElementById("detailThumb").src = d.thumbnail;
  document.getElementById("detailSynopsis").textContent = d.synopsis;

  const cl = document.getElementById("chapterList");
  cl.innerHTML = "";
  d.chapters.forEach(c => {
    const div = document.createElement("div");
    div.className = "chapter";
    div.textContent = c.title;
    div.onclick = () => loadChapter(c.slug);
    cl.appendChild(div);
  });
}

/* ===== CHAPTER ===== */
async function loadChapter(slug) {
  detailView.style.display = "none";
  readerView.style.display = "block";

  const res = await fetch(`${API}/chapter/${slug}`);
  const json = await res.json();
  const d = json.data;

  document.getElementById("chapterTitle").textContent = d.title;

  const box = document.getElementById("imageContainer");
  box.innerHTML = "";
  d.images.forEach(imgUrl => {
    const img = document.createElement("img");
    img.src = imgUrl;
    img.loading = "lazy";
    box.appendChild(img);
  });

  document.getElementById("prevChapter").disabled = !d.previous_chapter_slug;
  document.getElementById("nextChapter").disabled = !d.next_chapter_slug;

  document.getElementById("prevChapter").onclick =
    () => loadChapter(d.previous_chapter_slug);
  document.getElementById("nextChapter").onclick =
    () => loadChapter(d.next_chapter_slug);
}

/* ===== NAV ===== */
function setActiveTab(tab) {
  tabAll.classList.remove("active");
  tabLatest.classList.remove("active");
  tab.classList.add("active");
}

function backToList() {
  detailView.style.display = "none";
  readerView.style.display = "none";
  listView.style.display = "block";
}

function backToDetail() {
  readerView.style.display = "none";
  detailView.style.display = "block";
}

tabAll.onclick = loadAllManga;
tabLatest.onclick = loadLatestManga;

document.getElementById("searchInput").addEventListener("keydown", e => {
  if (e.key === "Enter") searchManga();
});

loadAllManga();
</script>

</body>
</html>
