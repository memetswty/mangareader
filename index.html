<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Komik Reader</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: #111;
  color: #fff;
}

header {
  background: #1f1f1f;
  padding: 15px;
  text-align: center;
  font-size: 22px;
  font-weight: bold;
}

/* ===== SEARCH ===== */
.search-wrap {
  background: #181818;
  padding: 10px;
}

.search-box {
  display: flex;
  gap: 8px;
}

.search-box input {
  flex: 1;
  padding: 12px 14px;
  border-radius: 25px;
  border: none;
  outline: none;
  background: #2a2a2a;
  color: #fff;
}

.search-box button {
  border-radius: 50%;
  width: 42px;
  height: 42px;
  border: none;
  cursor: pointer;
}

.clear-btn {
  background: #444;
  color: #fff;
}

/* autosuggest */
.suggest {
  background: #222;
  border-radius: 8px;
  margin-top: 6px;
  max-height: 200px;
  overflow-y: auto;
}

.suggest div {
  padding: 8px 12px;
  cursor: pointer;
}

.suggest div:hover {
  background: #333;
}

/* ===== FILTER ===== */
.filter {
  display: flex;
  gap: 8px;
  margin-top: 10px;
}

.filter select {
  flex: 1;
  padding: 8px;
  background: #222;
  color: #fff;
  border: none;
  border-radius: 6px;
}

/* ===== NAV ===== */
.nav {
  display: flex;
  background: #181818;
}

.nav button {
  flex: 1;
  padding: 12px;
  border: none;
  background: none;
  color: #aaa;
  font-weight: bold;
  cursor: pointer;
}

.nav button.active {
  color: #fff;
  background: #222;
  border-bottom: 2px solid #fff;
}

/* ===== LIST ===== */
.container {
  padding: 15px;
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
  gap: 15px;
}

.card {
  background: #1c1c1c;
  border-radius: 8px;
  overflow: hidden;
  cursor: pointer;
}

.card img {
  width: 100%;
  height: 220px;
  object-fit: cover;
}

.card-body {
  padding: 10px;
}

.title {
  font-size: 14px;
  font-weight: bold;
}

mark {
  background: #ffd54f;
  color: #000;
}

/* ===== PAGINATION ===== */
.pagination {
  display: flex;
  justify-content: space-between;
  padding: 10px 15px;
}

/* ===== DETAIL & READER ===== */
.detail, .reader {
  display: none;
  padding: 15px;
}

.chapter {
  background: #1c1c1c;
  padding: 10px;
  margin-bottom: 8px;
  border-radius: 5px;
  cursor: pointer;
}

.reader img {
  width: 100%;
  margin-bottom: 10px;
}

.nav-btns {
  display: flex;
  justify-content: space-between;
  margin-bottom: 15px;
}

button {
  padding: 8px 14px;
  border-radius: 5px;
  cursor: pointer;
  font-weight: bold;
}

button:disabled {
  opacity: 0.5;
}

.back-btn {
  background: #444;
  color: #fff;
  margin-bottom: 10px;
}
</style>
</head>

<body>

<header>üìö Komik Reader</header>

<!-- SEARCH -->
<div class="search-wrap">
  <div class="search-box">
    <input id="searchInput" placeholder="Cari judul komik...">
    <button onclick="searchManga()">üîç</button>
    <button class="clear-btn" onclick="clearSearch()">‚ùå</button>
  </div>

  <div id="suggestBox" class="suggest" style="display:none"></div>

  <div class="filter">
    <select id="typeFilter" onchange="applyFilter()">
      <option value="">Semua Type</option>
      <option value="Manga">Manga</option>
      <option value="Manhwa">Manhwa</option>
      <option value="Manhua">Manhua</option>
    </select>
  </div>
</div>

<!-- NAV -->
<div class="nav">
  <button id="tabAll" class="active">üìö Semua</button>
  <button id="tabLatest">üÜï Terbaru</button>
</div>

<!-- LIST -->
<div id="listView">
  <div class="container" id="mangaList"></div>

  <div class="pagination">
    <button id="prevPage">‚¨Ö Prev</button>
    <button id="nextPage">Next ‚û°</button>
  </div>
</div>

<!-- DETAIL -->
<div class="detail" id="detailView">
  <button class="back-btn" onclick="backToList()">‚¨Ö Kembali</button>
  <h2 id="detailTitle"></h2>
  <img id="detailThumb" style="width:150px;border-radius:8px">
  <p id="detailSynopsis"></p>
  <h3>üìñ Chapter</h3>
  <div id="chapterList"></div>
</div>

<!-- READER -->
<div class="reader" id="readerView">
  <button class="back-btn" onclick="backToDetail()">‚¨Ö Kembali</button>
  <h2 id="chapterTitle"></h2>
  <div class="nav-btns">
    <button id="prevChapter">‚¨Ö Sebelumnya</button>
    <button id="nextChapter">Lanjut ‚û°</button>
  </div>
  <div id="imageContainer"></div>
</div>

<script>
const API = "https://unofficial-komikcast-api.vercel.app/komikcast";
const mangaList = document.getElementById("mangaList");
const suggestBox = document.getElementById("suggestBox");

let mode = "all";
let searchQuery = "";
let searchPage = 1;
let allDataCache = [];

/* ===== UTIL ===== */
function highlight(text) {
  if (!searchQuery) return text;
  return text.replace(
    new RegExp(`(${searchQuery})`, "gi"),
    "<mark>$1</mark>"
  );
}

/* ===== LOAD ALL ===== */
async function loadAllManga() {
  mode = "all";
  const res = await fetch(API);
  const json = await res.json();
  allDataCache = json.data;
  renderList(allDataCache);
}

/* ===== LOAD LATEST ===== */
async function loadLatestManga() {
  mode = "latest";
  const res = await fetch(`${API}/latest`);
  const json = await res.json();
  allDataCache = json.data;
  renderList(allDataCache);
}

/* ===== SEARCH ===== */
async function searchManga(page = 1) {
  searchQuery = document.getElementById("searchInput").value.trim();
  if (!searchQuery) return;

  mode = "search";
  searchPage = page;

  const res = await fetch(`${API}/search?q=${encodeURIComponent(searchQuery)}&page=${page}`);
  const json = await res.json();

  allDataCache = json.data;
  renderList(allDataCache);

  document.getElementById("prevPage").disabled = !json.meta.pagination.previous_page;
  document.getElementById("nextPage").disabled = !json.meta.pagination.next_page;
}

/* ===== AUTOSUGGEST ===== */
let debounce;
document.getElementById("searchInput").addEventListener("input", e => {
  clearTimeout(debounce);
  debounce = setTimeout(() => {
    const val = e.target.value.trim();
    if (!val) {
      suggestBox.style.display = "none";
      return;
    }
    const result = allDataCache
      .filter(m => m.title.toLowerCase().includes(val.toLowerCase()))
      .slice(0, 5);

    suggestBox.innerHTML = "";
    result.forEach(r => {
      const d = document.createElement("div");
      d.textContent = r.title;
      d.onclick = () => {
        document.getElementById("searchInput").value = r.title;
        suggestBox.style.display = "none";
        searchManga();
      };
      suggestBox.appendChild(d);
    });
    suggestBox.style.display = result.length ? "block" : "none";
  }, 300);
});

/* ===== FILTER ===== */
function applyFilter() {
  const type = document.getElementById("typeFilter").value;
  let filtered = allDataCache;
  if (type) filtered = filtered.filter(m => m.type === type);
  renderList(filtered);
}

/* ===== RENDER ===== */
function renderList(data) {
  mangaList.innerHTML = "";
  if (data.length === 0) {
    mangaList.innerHTML = "<p>‚ùå Tidak ditemukan</p>";
    return;
  }

  data.forEach(m => {
    const div = document.createElement("div");
    div.className = "card";
    div.innerHTML = `
      <img src="${m.thumbnail}">
      <div class="card-body">
        <div class="title">${highlight(m.title)}</div>
      </div>
    `;
    div.onclick = () => loadDetail(m.slug);
    mangaList.appendChild(div);
  });
}

/* ===== CLEAR ===== */
function clearSearch() {
  document.getElementById("searchInput").value = "";
  suggestBox.style.display = "none";
  loadAllManga();
}

/* ===== DETAIL ===== */
async function loadDetail(slug) {
  document.getElementById("listView").style.display = "none";
  document.getElementById("detailView").style.display = "block";

  const res = await fetch(`${API}/detail/${slug}`);
  const json = await res.json();
  const d = json.data;

  detailTitle.textContent = d.title;
  detailThumb.src = d.thumbnail;
  detailSynopsis.textContent = d.synopsis;

  chapterList.innerHTML = "";
  d.chapters.forEach(c => {
    const div = document.createElement("div");
    div.className = "chapter";
    div.textContent = c.title;
    div.onclick = () => loadChapter(c.slug);
    chapterList.appendChild(div);
  });
}

/* ===== CHAPTER ===== */
async function loadChapter(slug) {
  detailView.style.display = "none";
  readerView.style.display = "block";

  const res = await fetch(`${API}/chapter/${slug}`);
  const json = await res.json();
  const d = json.data;

  chapterTitle.textContent = d.title;
  imageContainer.innerHTML = "";

  d.images.forEach(i => {
    const img = document.createElement("img");
    img.src = i;
    img.loading = "lazy";
    imageContainer.appendChild(img);
  });

  prevChapter.disabled = !d.previous_chapter_slug;
  nextChapter.disabled = !d.next_chapter_slug;

  prevChapter.onclick = () => loadChapter(d.previous_chapter_slug);
  nextChapter.onclick = () => loadChapter(d.next_chapter_slug);
}

/* ===== NAV ===== */
function backToList() {
  detailView.style.display = "none";
  readerView.style.display = "none";
  listView.style.display = "block";
}

function backToDetail() {
  readerView.style.display = "none";
  detailView.style.display = "block";
}

document.getElementById("prevPage").onclick = () => searchManga(searchPage - 1);
document.getElementById("nextPage").onclick = () => searchManga(searchPage + 1);

tabAll.onclick = loadAllManga;
tabLatest.onclick = loadLatestManga;

loadAllManga();
</script>

</body>
</html>
