<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Komik Reader</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: #111;
  color: #fff;
}

header {
  background: #1f1f1f;
  padding: 15px;
  text-align: center;
  font-size: 22px;
  font-weight: bold;
}

/* ===== LIST ===== */
.container {
  padding: 15px;
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
  gap: 15px;
}

.card {
  background: #1c1c1c;
  border-radius: 8px;
  overflow: hidden;
  cursor: pointer;
}

.card img {
  width: 100%;
  height: 220px;
  object-fit: cover;
}

.card-body {
  padding: 10px;
}

.title {
  font-size: 14px;
  font-weight: bold;
}

.info {
  font-size: 12px;
  color: #ccc;
}

/* ===== DETAIL ===== */
.detail, .reader {
  display: none;
  padding: 15px;
}

.detail-header {
  display: flex;
  gap: 15px;
}

.detail-header img {
  width: 160px;
  border-radius: 8px;
}

.genres span {
  background: #333;
  padding: 4px 8px;
  border-radius: 5px;
  font-size: 12px;
  margin-right: 5px;
}

.chapter {
  background: #1c1c1c;
  padding: 10px;
  margin-bottom: 8px;
  border-radius: 5px;
  cursor: pointer;
}

/* ===== READER ===== */
.reader img {
  width: 100%;
  margin-bottom: 10px;
}

.nav-btns {
  display: flex;
  justify-content: space-between;
  margin-bottom: 15px;
}

button {
  padding: 8px 14px;
  border: none;
  border-radius: 5px;
  cursor: pointer;
  font-weight: bold;
}

button:disabled {
  opacity: 0.5;
}

.back-btn {
  margin-bottom: 15px;
  background: #444;
  color: white;
}
</style>
</head>

<body>

<header>ðŸ“š Komik Reader</header>

<!-- LIST -->
<div id="listView">
  <div class="container" id="mangaList"></div>
</div>

<!-- DETAIL -->
<div class="detail" id="detailView">
  <button class="back-btn" onclick="showList()">â¬… Kembali</button>
  <div class="detail-header">
    <img id="detailThumb">
    <div>
      <h2 id="detailTitle"></h2>
      <div id="detailMeta"></div>
      <div class="genres" id="detailGenres"></div>
    </div>
  </div>
  <p id="detailSynopsis"></p>
  <h3>ðŸ“– Daftar Chapter</h3>
  <div id="chapterList"></div>
</div>

<!-- READER -->
<div class="reader" id="readerView">
  <button class="back-btn" onclick="backToDetail()">â¬… Kembali ke Detail</button>

  <h2 id="chapterTitle"></h2>

  <div class="nav-btns">
    <button id="prevChapter">â¬… Sebelumnya</button>
    <button id="nextChapter">Lanjut âž¡</button>
  </div>

  <div id="imageContainer"></div>
</div>

<script>
const API = "https://unofficial-komikcast-api.vercel.app/komikcast";

const listView = document.getElementById("listView");
const detailView = document.getElementById("detailView");
const readerView = document.getElementById("readerView");

let currentMangaSlug = "";
let currentChapterSlug = "";

async function loadManga() {
  const res = await fetch(API);
  const json = await res.json();
  const list = document.getElementById("mangaList");
  list.innerHTML = "";

  json.data.forEach(m => {
    const card = document.createElement("div");
    card.className = "card";
    card.innerHTML = `
      <img src="${m.thumbnail}">
      <div class="card-body">
        <div class="title">${m.title}</div>
        <div class="info">${m.latest_chapter?.title || ""}</div>
      </div>
    `;
    card.onclick = () => loadDetail(m.slug);
    list.appendChild(card);
  });
}

async function loadDetail(slug) {
  currentMangaSlug = slug;
  listView.style.display = "none";
  detailView.style.display = "block";

  const res = await fetch(`${API}/detail/${slug}`);
  const json = await res.json();
  const d = json.data;

  document.getElementById("detailThumb").src = d.thumbnail;
  document.getElementById("detailTitle").textContent = d.title;
  document.getElementById("detailMeta").textContent =
    `â­ ${d.rating} | ${d.type} | ${d.status}`;
  document.getElementById("detailSynopsis").textContent = d.synopsis;

  const g = document.getElementById("detailGenres");
  g.innerHTML = "";
  d.genres.forEach(x => g.innerHTML += `<span>${x}</span>`);

  const c = document.getElementById("chapterList");
  c.innerHTML = "";
  d.chapters.forEach(ch => {
    const div = document.createElement("div");
    div.className = "chapter";
    div.textContent = ch.title;
    div.onclick = () => loadChapter(ch.slug);
    c.appendChild(div);
  });
}

async function loadChapter(slug) {
  currentChapterSlug = slug;
  detailView.style.display = "none";
  readerView.style.display = "block";

  const res = await fetch(`${API}/chapter/${slug}`);
  const json = await res.json();
  const d = json.data;

  document.getElementById("chapterTitle").textContent = d.title;

  const imgBox = document.getElementById("imageContainer");
  imgBox.innerHTML = "";

  d.images.forEach(src => {
    const img = document.createElement("img");
    img.src = src;
    img.loading = "lazy"; // ðŸ”¥ LAZY LOAD
    imgBox.appendChild(img);
  });

  document.getElementById("prevChapter").disabled = !d.previous_chapter_slug;
  document.getElementById("nextChapter").disabled = !d.next_chapter_slug;

  document.getElementById("prevChapter").onclick =
    () => loadChapter(d.previous_chapter_slug);

  document.getElementById("nextChapter").onclick =
    () => loadChapter(d.next_chapter_slug);
}

function showList() {
  detailView.style.display = "none";
  readerView.style.display = "none";
  listView.style.display = "block";
}

function backToDetail() {
  readerView.style.display = "none";
  detailView.style.display = "block";
}

loadManga();
</script>

</body>
</html>
